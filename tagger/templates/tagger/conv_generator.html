{% extends "tagger/base.html" %}

<!-- Bootpag -->

{% block script %}
<link rel="stylesheet" href="../../static/css/base/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="../../static/css/glyphicon.css">
<link rel="stylesheet" href="../../static/css/tagger/tagger.css">

<script type="text/javascript" src="../../static/js/base/jquery.min.js"></script>
<script type="text/javascript" src="../../static/js/base/bootstrap.bundle.min.js"></script>
<script type="text/javascript" src="../../static/js/base/long-press.js"></script>
<script type="text/javascript" src="../../static/js/base/popper.js"></script>
<script type="text/javascript" src="../../static/js/base/bootstrap.min.js"></script>
<script type="text/javascript" src="../../static/js/base/jquery.min.js"></script>
<script type="text/javascript" src="../../static/js/tagger/tagger.js"></script>  
<script type="text/javascript" src="../../static/js/base/bootstrap.min.js"></script>

{% endblock %}

{% block body_block %}
<div class="container-fluid">
    <div class="row">
        <div class="col-md-6">
            <div class="chatbody">
                <div class="panel panel-primary">
                    <div class="panel-heading top-bar">
                        <div class="row">
                            <div class="row">
                                <div class="col-md-3 offset-md-3"><h3><span class="glyphicon glyphicon-plus">Customer</span></h3></div>
                                <div class="col-md-3 offset-md-3"><h3><span class="glyphicon glyphicon-plus">Agent</span></h3></div>

                                <div class="col-md-3 offset-md-3">.col-md-3 .offset-md-3</div>
                                <div class="col-md-3 offset-md-3">.col-md-3 .offset-md-3</div>

                            </div>
                        </div>
                    </div>
                    <div class="panel-body msg_container_base">
                    </div>
                    <div class="panel-footer">
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="panel panel-primary">
                <div class="panel-heading top-bar">
                    <div class="col-md-8">
                        <h3 class="panel-title"><span class="glyphicon glyphicon-book"></span>  Tagging info</h3>
                    </div>
                </div>
                <div>
                    <div class="jumbotron" style = 'height: 90%'>
                        <h1>Scenario looks like this!!</h1>
                        <p><script type='text/javascript' src='https://app.botsociety.io/embc/5c989c25339f19620cbbe776'></script><a class='botsocref' style='position:fixed;left:-30000px;' href='https://botsociety.io'>botsociety</a><a class='botsoc' rel='nofollow' href='https://app.botsociety.io/emb/5c98a40f339f190232bbecd6?p=6fec8e50d7d9483252e9cfe6c30087bc40d60583' target='medium'></a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    var conv;
    var id_name = [];
    $(document).ready(function(){
        $.ajax({
            type: 'GET',
            //url: 'http://172.23.148.117:9200/twd_index/_search?from=20&size=35',
            'url': '../../static/data/conv.json',
            "cache": true,
            "dataSrc": function(json){
                return json;
            },
            "dataType": "json",
            success: function(data) {
                console.log('success');
                tmp = {};
                $.each(data['hits']['hits'], function(c){
                    tmp[c] = data['hits']['hits'][c]['_source']['name'];                    
                });
                entire_conv = data;
                id_name= tmp;
            }
        });

    // init bootpag
    $('#page-selection').bootpag({
        total: 10,
            page: 1,
            maxVisible: 5
        }).on('page', function(event, num){

            conv_name = decide_id(num - 1, id_name);
            conv_string = get_conv(conv_name, entire_conv);
            $.ajax({
                url: '/tagger/conv_tagger_inner'+'?conv=' + JSON.stringify(conv_string)
            }).done(function(data) {
                $( "#content" ).html( data );
            });
        });
    });

    function decide_id(id, id_name){
        return id = id_name[id];
    }

    function get_conv(conv_name, _conv){
        _data = _conv['hits']['hits'];
        conv_with_id = {};
        refined_conv = [];
        
        $.each(_data, function(value){
            console.log('line 73 - ' + _data[value]['_source']['name']);
            if (_data[value]['_source']['name'] === conv_name){
                conv_with_id['id'] = _data[value]['_source']['name'];                
                _conv = _data[value]['_source']['sentences'];
                $.each(_conv, function(value){
                    _conv[value]['text'] = _conv[value]['text'].replace(/\n/g, '').replace(/"/g, '\'');
                    if(_conv[value]['speaker'] !== 'System'){
                        _conv[value]['created_date'] = _conv[value]['created_date'].replace(/:/g,'-');
                        refined_conv.push(_conv[value]);
                    }
                });
            }
        });
        conv_with_id['sentences'] = refined_conv; 
        return conv_with_id;
    }

</script>
{% endblock %}